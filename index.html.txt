<!DOCTYPE html>
<html>
<head>
    <title>Rastreador en Tiempo Real</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>#map { height: 500px; width: 100%; }</style>
</head>
<body>
    <h3>Mi ubicación en carretera</h3>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var marker = L.marker([0, 0]).addTo(map);

        // Función para enviar ubicación desde el celular
        function sendLocation() {
            navigator.geolocation.watchPosition(pos => {
                const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                fetch('/update', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(coords)
                });
            });
        }

        // Función para actualizar el mapa cada 3 segundos
        setInterval(async () => {
            const res = await fetch('/location');
            const data = await res.json();
            if(data.lat !== 0) {
                const newPos = [data.lat, data.lng];
                marker.setLatLng(newPos);
                map.setView(newPos, 15);
            }
        }, 3000);

        // Si el usuario presiona un botón, empieza a transmitir
        sendLocation();
    </script>
</body>
</html>
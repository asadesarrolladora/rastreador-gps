<th>Unidad ID</th>
        <th>Estado</th>
        <th>üîã Bater√≠a</th>
        <th>üïí √öltima Conexi√≥n</th> <script>
    // Variable para saber si es la primera vez que recibimos se√±al
    let primeraCarga = true;

    function iniciarRastreo() {
        navigator.geolocation.watchPosition(pos => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            // EFECTO POSICI√ìN REAL: Si es el chofer, centrar el mapa en √©l
            if (primeraCarga) {
                map.setView([lat, lng], 16); // Zoom cercano a su posici√≥n
                primeraCarga = false;
            }

            fetch('/update/' + trailerId, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    lat: lat,
                    lng: lng,
                    battery: batteryLevel // Aseg√∫rate de tener la variable de bater√≠a
                })
            });
        }, null, { enableHighAccuracy: true });
    }

    async function refrescarSistema() {
        const res = await fetch('/fleet');
        const flota = await res.json();
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = ""; 

        for (let tid in flota) {
            const data = flota[tid];
            // ... (l√≥gica de marcadores igual a la anterior) ...

            // ACTUALIZAR TABLA CON HORA
            const row = `
                <tr>
                    <td><b>${tid}</b></td>
                    <td>
                        <span class="status-pill ${data.panic ? 'status-panic' : 'status-normal'}">
                            ${data.panic ? 'üö® P√ÅNICO' : '‚úÖ OK'}
                        </span>
                    </td>
                    <td>${data.battery}</td>
                    <td style="color: #3498db; font-weight: bold;">${data.last_seen}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        }
    }
    // ... resto del script
</script>